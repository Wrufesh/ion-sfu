syntax = "proto3";

option go_package = "github.com/pion/ion-sfu/pkg/proto";

package sfu;

service SFU {
    rpc Publish(stream PublishRequest) returns (stream PublishReply) {}
    rpc Unpublish(UnpublishRequest) returns (UnpublishReply) {}
    rpc Subscribe(SubscribeRequest) returns (SubscribeReply) {}
    rpc Unsubscribe(UnsubscribeRequest) returns (UnsubscribeReply) {}
}

message PublishRequest {
    string rid = 1;
    oneof payload {
        Connect connect = 2;
        Trickle trickle = 3;
    }
}

message PublishReply {
    string mid = 1;
    oneof payload {
        Connect connect = 2;
        Trickle trickle = 3;
    }
}

message UnpublishRequest {
    string mid = 1;
}

message UnpublishReply {}

message SubscribeRequest {
    string mid = 1;
    Options options = 2;
    SessionDescription description = 3;
}

message SubscribeReply {
    string mid = 1;
    SessionDescription description = 2;
}

message UnsubscribeRequest {
    string mid = 1;
}

message UnsubscribeReply {}

message SessionDescription {
    string type = 1; // "answer" | "offer" | "pranswer" | "rollback"
    string sdp = 2;
}

message Connect {
    SessionDescription description = 1;
    Options options = 2;
}

message Trickle {
    string candidate = 1;
}

message Options {
    uint32 bandwidth = 1;
    bool transportcc = 2;
    string codec = 3;
}